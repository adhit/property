from housecanary import *
import csv
import json

msa_ids = [
    29820,
    42680,
    42660,
    43300,
    26140,
    13380,
    14740,
    19660,
    30980,
    10500,
    34580,
    48300,
    36100,
    32900,
    27100,
    24540,
    38940,
    29420,
    41420,
    29460,
    46700,
    36260,
    28420,
    22420,
    24420,
    37340,
    25980,
    17460,
    24300,
    17660,
    41940,
    33700,
    39380,
    47380,
    41620,
    14260,
    32510,
    15260,
    49700,
    17820,
    34980,
    39900,
    36500,
    21660,
    55117,
    44700,
    41100,
    20500,
    26820,
    33870,
    48900,
    53033,
    19740,
    19100,
    14540,
    27500,
    36740,
    30860,
    44060,
    23020,
    31900,
    40140,
    23420,
    23540,
    40900,
    45300,
    16740,
    47300,
    26900,
    12060,
    36980,
    33011,
    14500,
    37860,
    25180,
    33260,
    18700,
    28140,
    43900,
    41740,
    53071,
    55039,
    40660,
    41860,
    23540,
    19300,
    16860,
    31460,
    16620,
    46220,
    39340,
    39820,
    22660,
    16940,
    31140,
    41700,
    27100,
    29020,
    24340,
    49420,
    40580,
]

if __name__ == "__main__":
    querymaker = QueryMaker()
    with open('hcri_out.csv', 'w') as f:
        csvwriter = csv.writer(f, delimiter = ',', quotechar = '"')
        for x in msa_ids:
            try:
                response = querymaker.query(Levels.MSA, x, ['hcri'])
            except:
                continue

            if response[0]['msa/hcri']['result'] is None:
                continue
            csvwriter.writerow([
                x,
                response[0]['msa/hcri']['result']['gross_yield_median'],
                response[0]['msa/hcri']['result']['gross_yield_average']
            ])
